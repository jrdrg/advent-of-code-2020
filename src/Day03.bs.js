// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE
'use strict';

var List = require("bs-platform/lib/js/list.js");
var $$Array = require("bs-platform/lib/js/array.js");
var Caml_array = require("bs-platform/lib/js/caml_array.js");
var Caml_int32 = require("bs-platform/lib/js/caml_int32.js");

var inputStr = "........#..#.##.#..............\n...#...............#.#.........\n...#..#...#..##....#...........\n...#.............#....#.....#..\n..#......#..#...#.......#......\n..............##...............\n#.......#.........#......#....#\n.#.....###.....#...#.#.#...#...\n#.....................#....#.#.\n.......#...................#...\n...#.#...................#....#\n....#....#.......#...#.........\n..##.#............#..#.........\n.....##.#..............##..###.\n...........#....#....#.........\n#.....#...#...#.#.#.#.##.#...#.\n.#...............#....##.......\n.....#..#......#....#.......##.\n.....#........#.......#........\n...#...##...#..##...#.....##...\n.....#.........#.###...##...#..\n.#.##...#........#.#.#.#....#..\n....#......##.#...#.....#....#.\n.......###..........#..#..#....\n......#...#.##.................\n....#...#...#.........#......#.\n.....#...........#...###....#..\n.....#...#.#.#....##.#......#.#\n......#...#.....#..#..#........\n#......#..#...##........###....\n##.....#....##..#.#.###.#...#..\n........#....#.......#.....#..#\n#.#.#.##.#.#...................\n..#...##....#......#.....##....\n.......#.##..#........##..#....\n.#.#....##......#.#..........#.\n#..............#............#..\n.#.#.#.#.#.####.#.#...##.......\n.#..#.....##.#.......#.##...#..\n..#.#........#.............#.#.\n..#.#..........#..#........#...\n..#..#...#.......##...#.#....##\n...#.....#.#.#.....#....#....#.\n.#...#......#.....#..##........\n...#.......##.#.#.....#......#.\n...........#.....#.#.......#...\n#...........#...#..#.#........#\n....#......#..##........#..###.\n.#..#........................#.\n#.......#......#...#...#..#....\n....#.#...#..#.#....#....##.#..\n.....#......#..#..........##.#.\n.#.....#...........#.........#.\n...###.#...#.......#.#.........\n.......#....#..........#..#...#\n......##..#.......#...##.......\n..#..........#.......#.........\n..........#..#..#..#..#........\n.#.................####...#.#.#\n..##.....#............#........\n....#.....###...#......#....#.#\n...##.#...........#.##......#..\n#..##..#..#....#...#..#........\n......#....#........#.......#..\n......#.....#......###.........\n.#.....#.#......#.......#......\n..#.........#..#..#........##.#\n..#.#....#.....#....##....#.#..\n...#.............##............\n........#..#..#......#...#.....\n.....#.#...#...##.....#.....#..\n.#..#.#..........##...##.....#.\n......##.#..........#...#.....#\n#.#.##......#....#..........#..\n................#.......#.##...\n#.......#.....#.......#....#...\n#..#.....#.##..##...........#..\n.....#....#.#.##..........#..##\n#.......#.....#.##...........#.\n........#.##........###..#.#...\n........#..................#...\n#.........................#...#\n....#.........#...#.#..#.....#.\n.#............#....#...........\n..#.#...#..##...#.#.......#....\n.#.#....#...........#.........#\n...#.#..........#.....#...#....\n......#....#.#...............##\n....##......###...##.##.....##.\n............#.#....#.#.....#..#\n.....#..#.....#.#...###....#...\n.......##....##..#...##..#...##\n.....#.......##..#...#...#....#\n#.........##....#........###.#.\n...#..##...#...#.........#.#.#.\n....#.#.....#.....#............\n#........#....#..#........#....\n.......#....#...#..............\n#...#.........##.....###.#.....\n.#....##..#...#..##.........#..\n....#.....#......##..#..#....#.\n#.#..#.........#........#......\n..#.......#.........#.....###..\n..#..........#...........#....#\n..#...............#......#..#..\n....#..#...#....###.....#..#..#\n#...#...#..#...........#....#..\n.#....#.#..#....#.#...........#\n.....#.....#..#....#..#....#...\n#.#..#...........#.#...........\n..................#.#.......#..\n...#.........#.....#..##....#..\n.........#.#...#.........##....\n...#..#....#.....#...#..#......\n.#.##.....#....#....#......##..\n##..#.........#.#....#...#.....\n#......#.#...#....#.#..#.......\n.......#.....#.....###....#.#..\n.#....##.#.....#...#.......#...\n.#.......#..#...#......#..#..##\n...............#...#...........\n#..............#....#.#.#....#.\n...........#..#.......#.##..#..\n..#......#.#....#...#.#.....#..\n#..............................\n#..#....#..........#...#.......\n......#.............#####......\n.#...###......#.#.#.##..#......\n............#.##.....#.........\n.........#....##....#..........\n###....#......#.......#........\n.#.......##..........#..#....#.\n#..#.....................#....#\n........#...........#..........\n..#..........#...#..#.........#\n..#..#......##................#\n.....##..#...#..#..............\n.......#...##..#...............\n.......##..#.####....#....#.#..\n#.#..#..........#........##....\n....##....#.#..#....#.#...#....\n......#.......#...#.....#...#..\n..#..#...#.....#.......###.....\n...#.......#.#.#.......#.##....\n...............#..#.#........#.\n.#....###.#......#.............\n.#..#...#....#.#..#.....#......\n.......#.##....#.#.##.##...#.#.\n..#...#....#.#..##.#.....#...##\n..#...#......#...#......#...#..\n....#..#...#.#..#......#.......\n#..#...............#......#.##.\n.#....#...#..........#.#.....#.\n.#..#.#.#................#..#..\n.#....#.#...#..##.###..#...###.\n#.............#.....#.........#\n...#.........#...#.......#..#..\n......#..#.........#..........#\n........##................#..#.\n......#...#.#.....#......##....\n...............#...#....#......\n...#.#..#..#.....##.###..##..#.\n.#....##......#...#..##..#.....\n.....#.........##.##....#...#..\n.....#.#..................####.\n#.....#...#.............##....#\n#.#..........#...#..#..#.......\n#..#.#.........#...............\n....#...#.........#...##.......\n...........#.....#..##..#......\n#.....#.......#.#........#.....\n..##..#.....#...##......#......\n....#....#.....................\n............#......#.........##\n.....##.............#.....##..#\n.......#.............#..#.#.##.\n.###...#......#..#........##.#.\n..#.#...#.#....#.....#..#......\n..#.#..#.##........#...#.......\n........#.#...............#..#.\n........##.......#...#.......#.\n...#........##.#..........#.#.#\n..#..###.#.#.......#.#......#..\n....#..........#...#..#........\n...#..#...#...#.#....#...#..#..\n...#...#........#......##...#.#\n#...........#..........#..#.##.\n...#..##..................#.#..\n...##.#...#....#.#...#.####....\n.....#...#.#.#..#..............\n.....#..#.#.#..#...............\n..#..#..##...#.#..#.....##....#\n.......#.#..#.....#....#.......\n...#..#....#.........#...#.....\n..............#.#...#...##.....\n...................#...........\n.#......#.#...................#\n.##.....#........#.........#..#\n.##..##...#...................#\n...#....#.#..#.#.#..#.....##...\n.......#..#....#......####.#...\n.##..#..##....#.......#........\n.#...#...........##............\n.....#.....#........#..........\n....##..#....#.....#...........\n.#...#....................#....\n....#.........#.......##.....#.\n.#....#..#.....#.##....#.......\n....#..#.........#.#....#.#....\n.......#.........##....#.......\n..#......#....#....#...#.......\n........#..#.......#.##......#.\n..#.....#......#...#..#.......#\n#..#.....##...#...#............\n.......##.......#........#...#.\n..#......................#...#.\n....##.#.............#......#..\n#.#............................\n...##.#.....#.#............#.##\n......#...#..#.........##......\n.#.......#.....##.......#.#....\n...........#.#.........#..##...\n...#..........#.##....#........\n........#..#..#...#....#....#..\n........##....#.#....#........#\n..#........##....###....#......\n#................###...#...#...\n................#.#..###......#\n..#.....##.#................#..\n.....#...............#..#......\n..#.......####.....#..#.#....##\n..#.....#..#....#..............\n#.#...........#.#.....#..##....\n#.#..........#.......#...#.###.\n........#....#...#..#.#........\n.#.....#......#..#..#..###..#..\n.#.........#.##.#.#......##....\n..#.........#...##..#........#.\n.#...................#.........\n...#.#........#................\n............#.....#..##........\n..#.....#.#......#.......#...#.\n........#....##..##...#.....##.\n.#........#.#....#.#....#.#..#.\n#.#.......#....................\n.#..#...##.........#..#........\n.........#...............#.....\n...#...#.....#......#.......#..\n###......................#.#..#\n...#.....####........#..#.....#\n#.#...#.#...................##.\n.........#.....................\n#..........##..#.....#....#....\n.......#...#.#.##.#..##........\n..........#..#.#..#.#.......#.#\n.....................#.#...#...\n...........#.#........#.#.#....\n.......#......#........#...#.#.\n.........#....................#\n.##.##....#...#.#.#.#..........\n#....##..#.##....#....#.......#\n.##.#...#...............#....#.\n.......#...#.###....#..........\n.....#....#...#..#.............\n#.........#.##....#.#.#........\n..#...#.............##..#..#...\n#..##.......#..........#...#.#.\n.#..#.....#...........#......#.\n......#......#..............##.\n.#...#..#...#..####.....#.....#\n....##.......#..........##.....\n.#.....#.......#.....#.#...#...\n..#..#..#.#...#......#.........\n......#.#....#........#.......#\n........#.......#..............\n..#...#.#....#........#.......#\n............#....#...##.#......\n.........#.............#..#....\n#.............#.#..##.......#..\n#....#...........###....#......\n...#.....................#.....\n....#.#..........#...#.......#.\n......#..#.......#...#...#....#\n.#.#..#.....##.#........#......\n...........#...#.#.............\n...###............#...#..#.....\n..#.#.......#...#.#..#.........\n.#......##...........#.....#.##\n.....##.....#....##...##.#.#...\n..........#.#.#......#........#\n..#.#........#....##....#.#....\n.#....#...##...........#....#..\n##......#...#.......#..........\n.##...###..#...#......#..##.#.#\n...........##.#..##...#.......#\n..#..............##............\n........#..#........#...#..#.#.\n..#.............#......#...##..\n#...##....#...#....#....#.#....\n.#.#......#..##............#.#.\n.....###.#....##....#....#.....\n#.#.#..........#...#...#.#.#...\n.....#.#...........####........\n.....#....##...#.##..#......#..\n#....#.......#.##.......#..#...\n.....#.....#........#..........\n.......#.......#...#.##......#.\n...#.........##...#.#.#......##\n#........#........#...#..#.....\n.#......#.#......#.#...#....#..\n#..#....##.....##..............\n...#.##............#..........#\n.....#.#....#..#.#............#\n..#......#...###.##.......###..\n........#....#.#.#.#...........\n............#..#........#.....#\n....#...............#..........\n......#....#....###..#.......##\n#...#...##....#.........#...#..\n...........#.#.............#...\n...#..#.....#..##.#....#......#\n..#...#..#...#......#..........\n....#..#....#.......#........#.";

var startingMap = $$Array.map((function (param) {
        return param.split("");
      }), inputStr.split("\n"));

function repeatMap(initialMap, currentMap) {
  return $$Array.mapi((function (rowIdx, row) {
                return $$Array.concat(/* :: */[
                            row,
                            /* :: */[
                              Caml_array.caml_array_get(initialMap, rowIdx),
                              /* [] */0
                            ]
                          ]);
              }), currentMap);
}

function isTree(map, param) {
  return Caml_array.caml_array_get(Caml_array.caml_array_get(map, param[1]), param[0]) === "#";
}

function traverse(_param, _treeCount) {
  while(true) {
    var param = _param;
    var treeCount = _treeCount;
    var match = param.slope;
    var sY = match[1];
    var sX = match[0];
    var match$1 = param.current;
    var cY = match$1[1];
    var cX = match$1[0];
    var map = param.map;
    var bottomRow = map.length;
    var newX = cX + sX | 0;
    var newY = cY + sY | 0;
    if (newY < bottomRow && newX >= Caml_array.caml_array_get(map, newY).length) {
      _param = {
        map: repeatMap(startingMap, map),
        current: /* tuple */[
          cX,
          cY
        ],
        slope: /* tuple */[
          sX,
          sY
        ]
      };
      continue ;
    } else if (newY >= bottomRow) {
      return treeCount;
    } else {
      var match$2 = isTree(map, /* tuple */[
            newX,
            newY
          ]);
      var numTrees = match$2 ? treeCount + 1 | 0 : treeCount;
      _treeCount = numTrees;
      _param = {
        map: map,
        current: /* tuple */[
          newX,
          newY
        ],
        slope: /* tuple */[
          sX,
          sY
        ]
      };
      continue ;
    }
  };
}

function day1(slope) {
  return traverse({
              map: startingMap,
              current: /* tuple */[
                0,
                0
              ],
              slope: slope
            }, 0);
}

console.log("Day1:", day1(/* tuple */[
          3,
          1
        ]));

function day2(slopes) {
  return List.fold_left((function (accum, slope) {
                var trees = day1(slope);
                return Caml_int32.imul(trees, accum);
              }), 1, slopes);
}

console.log("Day2:", day2(/* :: */[
          /* tuple */[
            1,
            1
          ],
          /* :: */[
            /* tuple */[
              3,
              1
            ],
            /* :: */[
              /* tuple */[
                5,
                1
              ],
              /* :: */[
                /* tuple */[
                  7,
                  1
                ],
                /* :: */[
                  /* tuple */[
                    1,
                    2
                  ],
                  /* [] */0
                ]
              ]
            ]
          ]
        ]));

var _inputStr = "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#...##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#";

exports.inputStr = inputStr;
exports._inputStr = _inputStr;
exports.startingMap = startingMap;
exports.repeatMap = repeatMap;
exports.isTree = isTree;
exports.traverse = traverse;
exports.day1 = day1;
exports.day2 = day2;
/* startingMap Not a pure module */
